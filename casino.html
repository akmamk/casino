<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casino WebApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: #1a1a2e;
            color: white;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #16213e;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .balance {
            font-size: 18px;
            font-weight: bold;
            color: #ffcc00;
        }
        .nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: #0f3460;
            padding: 10px;
            border-radius: 8px;
        }
        .nav-btn {
            padding: 10px 15px;
            background: transparent;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        .nav-btn.active {
            background: #e94560;
        }
        .page {
            display: none;
            animation: fadeIn 0.5s;
        }
        .page.active {
            display: block;
        }
        .cases-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .case {
            background: linear-gradient(135deg, #ffcc00, #ff9500);
            padding: 25px 10px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .case:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        .case-price {
            font-weight: bold;
            margin-top: 5px;
            color: #fff;
        }
        .inventory-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        .inventory-item {
            background: #0f3460;
            padding: 12px 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }
        .inventory-item:hover {
            background: #1a3a6e;
        }
        .upgrade-section {
            margin-top: 20px;
            background: #0f3460;
            padding: 15px;
            border-radius: 8px;
        }
        .upgrade-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        select, button {
            padding: 10px 15px;
            border-radius: 5px;
            border: none;
            background: #e94560;
            color: white;
            cursor: pointer;
        }
        button:disabled {
            background: #555;
            cursor: not-allowed;
        }
        .status-message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        .success {
            background: rgba(0, 200, 0, 0.2);
        }
        .error {
            background: rgba(200, 0, 0, 0.2);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes spin {
            0% { transform: rotate(0deg) scale(1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .spinning {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="balance">üåü –ë–∞–ª–∞–Ω—Å: <span id="stars">0</span></div>
            <div class="app-title">üé∞ Casino App</div>
        </div>

        <div class="nav">
            <button class="nav-btn active" data-page="main">–ì–ª–∞–≤–Ω–∞—è</button>
            <button class="nav-btn" data-page="inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
            <button class="nav-btn" data-page="upgrade">–ê–ø–≥—Ä–µ–π–¥</button>
        </div>

        <div id="main" class="page active">
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ –∫–µ–π—Å:</h2>
            <div class="cases-grid">
                <div class="case" data-price="50">
                    <div class="case-icon">üéÅ</div>
                    <div class="case-name">–û–±—ã—á–Ω—ã–π</div>
                    <div class="case-price">50üåü</div>
                </div>
                <div class="case" data-price="100">
                    <div class="case-icon">üéÅ</div>
                    <div class="case-name">–†–µ–¥–∫–∏–π</div>
                    <div class="case-price">100üåü</div>
                </div>
                <div class="case" data-price="200">
                    <div class="case-icon">üéÅ</div>
                    <div class="case-name">–≠–ø–∏—á–µ—Å–∫–∏–π</div>
                    <div class="case-price">200üåü</div>
                </div>
                <div class="case" data-price="500">
                    <div class="case-icon">üéÅ</div>
                    <div class="case-name">–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π</div>
                    <div class="case-price">500üåü</div>
                </div>
            </div>
            <div id="spin-status" class="status-message"></div>
        </div>

        <div id="inventory" class="page">
            <h2>–í–∞—à –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å:</h2>
            <div id="inventory-list" class="inventory-list">
                <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –ø—Ä–µ–¥–º–µ—Ç—ã -->
            </div>
        </div>

        <div id="upgrade" class="page">
            <h2>–£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</h2>
            <div class="upgrade-section">
                <h3>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:</h3>
                <div id="upgrade-items" class="inventory-list">
                    <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è -->
                </div>
                
                <div class="upgrade-controls">
                    <select id="upgrade-value">
                        <option value="100">100üåü (—à–∞–Ω—Å 90%)</option>
                        <option value="200">200üåü (—à–∞–Ω—Å 70%)</option>
                        <option value="500">500üåü (—à–∞–Ω—Å 50%)</option>
                    </select>
                    <button id="upgrade-btn">–£–ª—É—á—à–∏—Ç—å</button>
                </div>
                <div id="upgrade-status" class="status-message"></div>
            </div>
        </div>
    </div>

    <script>
        const webApp = Telegram.WebApp;
        webApp.ready();
        webApp.expand();

        let userData = {
            stars: 0,
            inventory: [],
            upgrades: {}
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            setupNavigation();
            setupCases();
            setupUpgrade();
            loadUserData();
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function setupNavigation() {
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                    
                    btn.classList.add('active');
                    document.getElementById(btn.dataset.page).classList.add('active');
                });
            });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–µ–π—Å–æ–≤
        function setupCases() {
            document.querySelectorAll('.case').forEach(caseEl => {
                caseEl.addEventListener('click', async () => {
                    const price = parseInt(caseEl.dataset.price);
                    
                    if (userData.stars < price) {
                        showStatus('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥!', 'error');
                        return;
                    }
                    
                    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–µ–π—Å –Ω–∞ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
                    caseEl.style.pointerEvents = 'none';
                    const caseIcon = caseEl.querySelector('.case-icon');
                    caseIcon.classList.add('spinning');
                    caseIcon.textContent = 'üåÄ';
                    
                    showStatus('–û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–µ–π—Å...', 'success');
                    
                    try {
                        const response = await sendToBot({
                            action: 'spin',
                            price: price
                        });
                        
                        if (response.status === 'success') {
                            userData = response.data;
                            updateUI();
                            showStatus(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: ${response.data.won_item}`, 'success');
                        } else {
                            showStatus(response.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –∫–µ–π—Å–∞', 'error');
                        }
                    } catch (e) {
                        console.error('Error:', e);
                        showStatus('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
                    } finally {
                        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–µ–π—Å
                        caseIcon.classList.remove('spinning');
                        caseIcon.textContent = 'üéÅ';
                        caseEl.style.pointerEvents = 'auto';
                    }
                });
            });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã —É–ª—É—á—à–µ–Ω–∏—è
        function setupUpgrade() {
            document.getElementById('upgrade-btn').addEventListener('click', async () => {
                const selectedItem = document.querySelector('#upgrade-items input:checked');
                if (!selectedItem) {
                    showStatus('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç!', 'error', 'upgrade-status');
                    return;
                }
                
                const value = parseInt(document.getElementById('upgrade-value').value);
                if (userData.stars < value) {
                    showStatus('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥!', 'error', 'upgrade-status');
                    return;
                }
                
                const upgradeBtn = document.getElementById('upgrade-btn');
                upgradeBtn.disabled = true;
                showStatus('–ü—ã—Ç–∞–µ–º—Å—è —É–ª—É—á—à–∏—Ç—å...', 'success', 'upgrade-status');
                
                try {
                    const response = await sendToBot({
                        action: 'upgrade',
                        item: selectedItem.value,
                        value: value
                    });
                    
                    if (response.status === 'success') {
                        userData = response.data;
                        updateUI();
                        showStatus(response.message || '–£—Å–ø–µ—à–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ!', 'success', 'upgrade-status');
                    } else {
                        showStatus(response.message || '–û—à–∏–±–∫–∞ —É–ª—É—á—à–µ–Ω–∏—è', 'error', 'upgrade-status');
                    }
                } catch (e) {
                    console.error('Error:', e);
                    showStatus('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error', 'upgrade-status');
                } finally {
                    upgradeBtn.disabled = false;
                }
            });
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadUserData() {
            sendToBot({action: 'get_data'})
                .then(response => {
                    if (response.status === 'success') {
                        userData = response.data;
                        updateUI();
                    } else {
                        showStatus(response.message || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
                    }
                })
                .catch(e => {
                    console.error('Error:', e);
                    showStatus('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è', 'error');
                });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
            document.getElementById('stars').textContent = userData.stars;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            const inventoryList = document.getElementById('inventory-list');
            inventoryList.innerHTML = userData.inventory.map((item, index) => `
                <div class="inventory-item">
                    <span>${item}</span>
                </div>
            `).join('');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è
            const upgradeItems = document.getElementById('upgrade-items');
            upgradeItems.innerHTML = userData.inventory.map((item, index) => `
                <div class="inventory-item">
                    <input type="radio" name="upgrade-item" id="item-${index}" value="${item}">
                    <label for="item-${index}">${item}</label>
                </div>
            `).join('');
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç—É
        function sendToBot(data) {
            return new Promise((resolve, reject) => {
                webApp.sendData(JSON.stringify(data));
                
                const handler = (response) => {
                    try {
                        const result = JSON.parse(response);
                        webApp.offEvent('messageSent', handler);
                        resolve(result);
                    } catch (e) {
                        webApp.offEvent('messageSent', handler);
                        reject(e);
                    }
                };
                
                webApp.onEvent('messageSent', handler);
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å
        function showStatus(message, type, elementId = 'spin-status') {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = `status-message ${type}`;
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            if (message) {
                setTimeout(() => {
                    statusElement.textContent = '';
                    statusElement.className = 'status-message';
                }, 3000);
            }
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>